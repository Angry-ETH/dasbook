# 应用

L1 和 L2 扩容是一个复杂而庞大的主题。本文不会深入讨论其全部内容，而是专注于数据可用性这一核心视角进行简要介绍。你可以参考 [扩容文档](https://ethereum.org/zh/developers/docs/scaling/) 了解更完整的技术细节。

## L1 扩容

最直接的扩容方式，就是让主链本身处理更多交易。得益于数据可用性采样（DAS）与零知识证明（ZKP）的结合，这一目标变得可行：

- **数据可用性**：通过 DAS 确保链上数据已被完整发布；
- **计算有效性**：通过 ZKP 验证交易执行结果，无需重新执行计算过程。

这两点指向了一个极端的终极形态，验证者无需存储状态，也无需下载交易数据，仅凭一个轻量的证明即可验证整个区块。验证者的工作量降至极低，甚至可以在手机或浏览器插件中运行。

当然，这种扩容方式的计算工作并未消失。ZKP 的生成过程本身极为繁重，需要大量计算资源，还必须在一个区块时间内完成。这就引出了一个关键问题：谁来生成证明？

最直接的方法是将任务交给资源充沛的大型节点，但这会带来中心化风险。从根本上解决这个问题，需要降低证明生成的成本，其中包括共识层本身的证明以及 EVM 的证明。其中，由于 EVM 在设计时无法预见到 ZK 友好的要求，导致证明效率低下，因此如何在虚拟机层面进行 ZK 友好的优化成为一个重要议题。

而共识层的 ZK 化，需要完成一些列前置条件，例如修改区块结构、共识机制等等，特别是需要实现成熟的无状态客户端。从长期来看，将这类扩容机制先部署在应用层，是更加稳健的做法。当前 zkEVM 已取得显著进展，成为这一策略的重要代表。而且，L2 总是比 L1 具有更高的效率，可以满足应用层的不同需求，它将会长期存在。

## Rollup

Rollup 提供了另一种扩容路径，它将主链的职责简化为数据存储与结算，将执行任务移至链下。你可以将它理解为一种执行分片：

- 在链下完成交易执行与状态更新；
- 将数据与结果发布至主链进行验证与结算；

Rollup 的设计已经趋于成熟，但具体实现方式仍有许多差异，尤其在证明机制、数据发布策略和最终性保障等方面，直接影响了其性能、安全性与适用性。

### ZK-Rollup

ZK-Rollup 使用零知识证明技术，将链下交易执行封装成一个有效性证明，连同状态根一同提交至主链合约。主链仅需验证该证明是否成立，便可确认整批交易的正确性，无需执行其中的任何交易。与此同时，Rollup 还需对状态增量做出某种加密承诺，并将其与证明绑定，以确保被发布的数据确实能导致状态正确地变更，从而保证新的状态可被获得。

相较于 L1 的 ZK 扩容，ZK-Rollup 对实时性的要求要低得多。zkEVM 试图复刻完整的 EVM 行为，使现有合约无需改动即可迁移至 Rollup 环境。但由于 EVM 本身不具备 ZK 友好性，生成证明成本很高，成为效率瓶颈。因此，部分系统选择定制 zkVM，或在电路层面引入高度优化，使得批量交易的证明可以在更短时间内生成。

### Optimistic Rollup

相较于 ZK-Rollup 需要昂贵的计算生成有效性证明，Optimistic Rollup 的计算开销则要低得多，但代价是引入了一个不可跳过的挑战期，在此期间交易结果并未被最终确认。

Optimistic Rollup 更偏向工程实用主义。它假设链下执行结果是正确的，在无需证明的前提下将结果直接提交到链上，同时设置挑战期。如果有观察者发现错误，可在挑战期内提交欺诈证明。

挑战的原理可以理解为在链上实现一个等效 EVM 的合约，挑战者将交易数据发送给合约重新执行，如果最终计算结果和先前提交的并不一致，则挑战成功。值得一提的是，在实践中这种单步挑战实际上是不可行的，因为我们无法实现完全等效的 EVM 合约，任何细微的差别（例如 Gas 计价）都将带来安全问题。

需要注意的是，挑战者必须要获得交易数据才能重新执行并发现错误，也才能提交欺诈证明。若攻击者隐藏交易数据，用户将无法发起挑战。因此，Optimistic Rollup 必须将所有交易数据以数据可用性的方式完整发布到主链，其对数据可用性的依赖高于 ZK-Rollup。

## Validium

与标准意义上的 Rollup 不同的是，Validium 不要需要主链提供数据可用性，而是直接转移至链下，主链只验证 ZKP 提交的状态变更是否正确。

这显著减少了链上数据负担，降低了交易成本，提高了系统吞吐量。Validium 特别适用于对数据上链要求不高的应用场景，如游戏、身份系统、NFT 或企业账本。同时，在注重隐私的数据场景中，Validium 也具备独特优势。

为了保证链下数据的安全性，Validium 通常设立一个由许可节点组成的数据可用性委员会（DAC），这些节点在链下维护数据并在必要时对外提供。因此必须要假设多数 DAC 成员是诚实d的，如果多数节点宕机或作恶，用户将无法提取资产，系统陷入冻结。

为应对这一风险，Validium 提供单点退出机制。用户只需提交默克尔证明，即可在链上证明其账户数据，主动退出。但这是一种一次性的安全保障，并不能替代持续的数据可用性。

## Volition

Volition 是在 Validium 基础上的进一步演化，允许用户为每笔交易选择是否上链存储数据：

- 若发布数据至主链，则享受与 Rollup 等价的安全性；
- 若保留数据在链下，则享受 Validium 的高效率与低成本；

这让开发者可以灵活调整安全模型，以适配不同用户、用途与资金规模，同时保持主链上的统一验证逻辑。